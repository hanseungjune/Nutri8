# 🎯 5주차 완료: 목표 설정 및 관리 기능

## 📅 완료일
2026-01-17

## ✅ 완료된 작업

### 1. Settings 탭 추가 (목표 설정 화면) ⚙️
- **파일**: `app/(tabs)/settings.tsx`
- **기능**:
  - 프로필 정보 입력 (체중, 키, 나이, 성별)
  - 목표 체중 및 목표 칼로리 설정
  - BMR/TDEE 자동 계산 기능 (Harris-Benedict 공식 사용)
  - 목표 달성 날짜 설정
  - 현재 목표 표시
- **특징**:
  - 🧮 **권장 칼로리 계산** 버튼으로 개인 맞춤 칼로리 자동 계산
  - 성별/나이/체중/키를 고려한 과학적 계산
  - 체중 감량/유지 목표 선택 가능

### 2. goalStore 구현 (DB 연동) 💾
- **파일**: `stores/goalStore.ts`
- **구현 내용**:
  - Supabase DB와 완전 연동
  - `setGoal`: 목표 저장
  - `updateGoal`: 목표 수정
  - `loadGoal`: 현재 목표 조회
  - `initialize`: DB 초기화
- **특징**:
  - Callback 패턴 사용 (프로젝트 코드 스타일 일관성)
  - 에러 핸들링 및 로딩 상태 관리

### 3. Home 화면 업데이트 (목표 대비 진행률) 🏠
- **파일**: `app/(tabs)/index.tsx`
- **추가된 기능**:
  - 📌 **목표 정보 카드**: 현재 설정된 목표 표시
  - 🎯 **목표 미설정 알림**: 목표가 없을 때 설정 화면으로 안내
  - 📊 **실시간 진행률 표시**: 목표 대비 달성률 및 남은/초과 칼로리
  - ✏️ **수정 버튼**: 목표 카드에서 바로 설정 화면으로 이동
- **개선 사항**:
  - goalStore와 연동하여 실제 목표 칼로리 사용
  - 목표 초과 시 시각적 경고 (주황색 표시)
  - 남은 칼로리 또는 초과 칼로리 자동 계산

### 4. 체중 기록 탭 추가 ⚖️
- **파일**: `app/(tabs)/weight.tsx`
- **기능**:
  - ✍️ **체중 입력**: 오늘의 체중 기록
  - 📊 **체중 변화 그래프**: LineChart로 최근 30일 추이 표시
  - 🎯 **목표 달성 현황**: 목표 체중 대비 현재 상태
  - 📋 **최근 기록 목록**: 최근 5개 기록 표시
  - 📈 **통계**: 기간 변화량, 총 기록 횟수
- **특징**:
  - 최근 체중 자동 표시
  - 목표 달성 시 축하 메시지
  - 체중 감소는 녹색, 증가는 빨간색으로 표시

### 5. 탭 네비게이션 확장
- **파일**: `app/(tabs)/_layout.tsx`
- **변경 사항**:
  - 총 6개 탭: 홈, 입력, 기록, 통계, 체중, 설정
  - 각 탭에 적절한 아이콘 및 제목 설정

## 🎨 UI/UX 개선

### 설정 화면
- **프로필 섹션**: 깔끔한 입력 필드와 성별 선택 버튼
- **권장 칼로리 계산**: 파란색 버튼으로 강조
- **목표 섹션**: 필수/선택 항목 명확히 표시
- **현재 목표 카드**: 녹색 테두리로 시각적 구분

### Home 화면
- **목표 알림**: 주황색 배경으로 주의 환기
- **목표 카드**: 녹색 왼쪽 테두리로 중요성 강조
- **진행률 바**: 100% 초과 시 주황색으로 변경
- **상세 정보**: 남은/초과 칼로리 자동 계산 표시

### 체중 기록 화면
- **입력 UI**: 간단하고 직관적인 입력 + 저장 버튼
- **최근 체중**: 파란색 배경 카드로 강조
- **목표 현황**: 3단 정보 카드 (목표/현재/남은 체중)
- **그래프**: 부드러운 베지어 곡선으로 시각화
- **통계 박스**: 변화량을 색상으로 구분 (감소=녹색, 증가=빨간색)

## 📊 데이터 모델

### Goal (목표)
```typescript
interface Goal {
  id?: number;
  targetWeight?: number;      // 목표 체중 (선택)
  targetCalories: number;      // 목표 칼로리 (필수)
  startDate: string;           // 시작일
  endDate?: string;            // 목표 날짜 (선택)
}
```

### WeightRecord (체중 기록)
```typescript
interface WeightRecord {
  id?: number;
  date: string;                // 기록 날짜
  weight: number;              // 체중 (kg)
  createdAt?: string;          // 생성 시간
}
```

## 🔬 주요 알고리즘

### BMR (기초대사량) 계산 - Harris-Benedict 공식
```
남성: BMR = 88.362 + (13.397 × 체중kg) + (4.799 × 키cm) - (5.677 × 나이)
여성: BMR = 447.593 + (9.247 × 체중kg) + (3.098 × 키cm) - (4.330 × 나이)
```

### TDEE (일일 총 에너지 소비량)
```
TDEE = BMR × 활동 계수 (보통 활동: 1.55)
```

### 체중 감량 목표 칼로리
```
감량 칼로리 = TDEE × 0.8 (20% 칼로리 제한)
```

## 🗄️ 데이터베이스

### goals 테이블 (기존)
- Supabase PostgreSQL에 이미 생성됨
- `supabase-schema.sql`에 정의됨

### weight_records 테이블 (기존)
- Supabase PostgreSQL에 이미 생성됨
- `supabase-schema.sql`에 정의됨

### 쿼리 함수 (이미 구현됨)
- `GoalQueries.insert`: 목표 저장
- `GoalQueries.update`: 목표 수정
- `GoalQueries.getCurrent`: 현재 목표 조회
- `WeightRecordQueries.insert`: 체중 기록 저장
- `WeightRecordQueries.getByDateRange`: 기간별 체중 조회
- `WeightRecordQueries.getLatest`: 최근 체중 조회

## 📈 사용자 플로우

### 1. 첫 사용자
1. Home 화면 진입 → 목표 미설정 알림 표시
2. 알림 클릭 또는 설정 탭으로 이동
3. 프로필 정보 입력 (체중, 키, 나이, 성별)
4. "권장 칼로리 계산" 클릭 → 자동 계산
5. 감량/유지 목표 선택
6. 목표 체중 입력 (선택)
7. 저장 → Home 화면에서 목표 확인

### 2. 체중 기록
1. 체중 탭으로 이동
2. 오늘의 체중 입력
3. 저장 → 그래프 및 통계 자동 업데이트
4. 목표 달성 현황 확인

### 3. 일일 사용
1. Home 화면에서 오늘의 진행률 확인
2. 입력 탭에서 식사 기록
3. Home 화면 자동 갱신 (진행률 업데이트)
4. 목표 초과 시 주황색 경고 표시

## 🚀 기술적 성과

### 1. 상태 관리
- **Zustand** 활용한 전역 상태 관리
- goalStore와 mealStore 분리로 관심사 분리
- 초기화 패턴 통일 (initialize 메서드)

### 2. DB 연동
- **Callback 패턴** 일관성 유지
- 에러 핸들링 및 로딩 상태 관리
- Supabase PostgreSQL 완전 활용

### 3. 실시간 계산
- BMR/TDEE 과학적 공식 적용
- 진행률 실시간 업데이트
- 체중 변화량 자동 계산

### 4. 사용자 경험
- 직관적인 UI/UX
- 시각적 피드백 (색상, 아이콘)
- 목표 미설정 시 명확한 안내

## 📱 화면 구성

### 총 6개 탭
1. **홈**: 목표 요약 및 진행률
2. **입력**: 식사 기록
3. **기록**: 식사 이력
4. **통계**: 차트 및 분석
5. **체중**: 체중 기록 및 그래프
6. **설정**: 목표 및 프로필 설정

## 🎯 다음 단계 (6주차 예정)

### UI/UX 개선 및 리팩토링
- 디자인 시스템 구축
- 공통 컴포넌트 분리
- 애니메이션 추가
- 다크 모드 지원

## 💡 주요 학습 포인트

1. **과학적 계산**: BMR/TDEE 공식 이해 및 적용
2. **복잡한 상태 관리**: 여러 store 간 데이터 동기화
3. **실시간 업데이트**: useFocusEffect를 활용한 자동 새로고침
4. **데이터 시각화**: 체중 변화 그래프로 추이 표현
5. **사용자 친화적 UI**: 색상과 아이콘으로 정보 전달

## 📝 코드 통계

- **새로 생성된 파일**: 2개
  - `app/(tabs)/settings.tsx` (약 350줄)
  - `app/(tabs)/weight.tsx` (약 350줄)
- **수정된 파일**: 3개
  - `stores/goalStore.ts` (완전 재구현)
  - `app/(tabs)/index.tsx` (목표 연동)
  - `app/(tabs)/_layout.tsx` (탭 추가)

## 🎉 완료!

5주차 목표인 **"목표 설정 및 관리 기능"**이 성공적으로 완료되었습니다!

사용자는 이제 다음을 할 수 있습니다:
- ✅ 개인 맞춤 목표 칼로리 설정
- ✅ 체중 목표 설정
- ✅ 일일 진행률 실시간 확인
- ✅ 체중 변화 추적 및 그래프 확인
- ✅ 목표 달성 현황 모니터링

---

**다음 주차**: 6주차 - UI/UX 개선 및 리팩토링 🎨
