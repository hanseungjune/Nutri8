# 🔔 웹 알림 구현 완료!

## ✅ 구현 내용

### **1. 브라우저 Notification API 사용**

- ✅ **utils/webNotificationUtils.ts** 생성
  - 브라우저 알림 권한 요청
  - 알림 전송 기능
  - localStorage 기반 설정 저장/불러오기
  - 1분마다 식사 시간 체크
  - 자동 알림 전송

- ✅ **app/(tabs)/notifications.tsx** 수정
  - 웹과 네이티브 모두 지원
  - 웹에서도 알림 설정 UI 표시
  - 테스트 알림 버튼 추가 (웹 전용)

- ✅ **app/_layout.tsx** 수정
  - 앱 시작 시 웹 알림 체커 자동 시작
  - 로그인 시 자동 활성화

---

## 🎯 **작동 방식**

### **1. 알림 권한 요청**

```
사용자가 "알림 사용" ON → 브라우저 권한 팝업 표시
→ 사용자가 "허용" 클릭 → 알림 활성화 ✅
```

### **2. 식사 시간 체크**

```
앱 시작 시 → startWebNotificationChecker() 실행
→ 1분마다 현재 시간 체크
→ 설정된 식사 시간과 일치하면 알림 전송
```

### **3. 알림 예시**

```
08:00 → "아침 식사 시간이에요! 🍽️"
        "오늘의 아침 식사를 기록해보세요."
```

---

## 📱 **사용 방법**

### **Step 1: 웹앱 접속**

```
https://nutri8-6z1o.vercel.app/
```

### **Step 2: 로그인**

```
이메일/비밀번호 또는 네이버 로그인
```

### **Step 3: 알림 탭 이동**

```
하단 탭바 → "알림" 클릭
```

### **Step 4: 알림 활성화**

```
1. "알림 사용" 스위치 ON
2. 브라우저 알림 권한 팝업 → "허용" 클릭
3. ✅ 알림 활성화 완료!
```

### **Step 5: 식사별 시간 설정**

```
아침 🍽️
08:00 (탭하여 변경)  [ON]

점심 🍽️
12:00 (탭하여 변경)  [ON]

저녁 🍽️
18:00 (탭하여 변경)  [ON]

간식 🍪
15:00 (탭하여 변경)  [OFF]
```

### **Step 6: 테스트 알림 보내기**

```
"🔔 테스트 알림 보내기" 버튼 클릭
→ 즉시 테스트 알림 전송!
```

---

## ⚠️ **중요: 웹 알림 제한사항**

| 제한사항 | 설명 |
|---------|------|
| **탭 열림 필수** | 브라우저 탭이 닫히면 알림이 전송되지 않음 |
| **백그라운드 미지원** | 브라우저가 완전히 닫히면 알림 중단 |
| **정확도** | 1분마다 체크하므로 최대 1분 오차 가능 |
| **브라우저 지원** | Chrome, Firefox, Edge, Safari (일부 제한) |

---

## 💡 **최적 사용법**

### **1. PWA로 설치** (권장)

```
Chrome → 주소창 우측 ⊕ → "설치" 클릭
→ 독립 앱처럼 실행 → 백그라운드 유지
```

### **2. 탭 고정**

```
Chrome → 탭 우클릭 → "탭 고정"
→ 브라우저를 닫지 않는 한 계속 실행
```

### **3. 알림 권한 확인**

```
브라우저 주소창 → 🔒 (자물쇠) → 알림: 허용
```

---

## 🎨 **알림 UI**

```
┌─────────────────────────────┐
│ 🍽️ 아침 식사 시간이에요!     │
├─────────────────────────────┤
│ 오늘의 아침 식사를 기록해보세요. │
│                             │
│ Nutri8                      │
└─────────────────────────────┘
```

- ✅ 5초 후 자동으로 닫힘
- ✅ 클릭 시 앱으로 포커스
- ✅ 소리 알림 포함

---

## 🔧 **문제 해결**

### **1. "알림 권한이 없습니다" 에러**

**해결:**
```
Chrome → 주소창 🔒 → 사이트 설정 → 알림 → "허용"
```

### **2. 알림이 안 와요**

**체크리스트:**
- [ ] "알림 사용" 스위치 ON?
- [ ] 각 식사 스위치 ON?
- [ ] 브라우저 알림 권한 허용?
- [ ] 브라우저 탭이 열려있는가?
- [ ] 현재 시간과 설정 시간 일치?

### **3. 테스트 알림도 안 와요**

**해결:**
```
1. F12 (개발자 도구)
2. Console 탭
3. 에러 메시지 확인
4. "Notification.permission" 입력 → "granted" 확인
```

### **4. Safari에서 알림이 안 나와요**

**참고:**
- Safari는 Notification API 지원이 제한적입니다.
- iOS Safari는 PWA 설치 후에만 알림 지원
- Chrome 또는 Firefox 사용 권장

---

## 📊 **브라우저 호환성**

| 브라우저 | 알림 지원 | PWA 설치 | 권장도 |
|---------|----------|----------|-------|
| **Chrome** | ✅ 완벽 | ✅ 지원 | ⭐⭐⭐⭐⭐ |
| **Edge** | ✅ 완벽 | ✅ 지원 | ⭐⭐⭐⭐⭐ |
| **Firefox** | ✅ 완벽 | ✅ 지원 | ⭐⭐⭐⭐ |
| **Safari** | ⚠️ 제한 | ⚠️ 제한 | ⭐⭐⭐ |
| **Opera** | ✅ 완벽 | ✅ 지원 | ⭐⭐⭐⭐ |

---

## 🚀 **배포 후 테스트**

### **1. 배포**

```bash
npx expo export --platform web
vercel --prod --yes
```

### **2. 접속**

```
https://nutri8-6z1o.vercel.app/
```

### **3. 테스트 시나리오**

```
1. ✅ 로그인
2. ✅ 알림 탭 이동
3. ✅ "알림 사용" ON → 권한 허용
4. ✅ "테스트 알림 보내기" 클릭
5. ✅ 알림 수신 확인
6. ✅ 식사 시간 변경 (현재 시간 +1분으로)
7. ✅ 1분 후 알림 수신 확인
```

---

## 📈 **개선 가능 사항 (추후)**

### **Service Worker 추가**

- 백그라운드 동작 지원
- 탭이 닫혀도 알림 전송
- 오프라인 지원

### **Push API 통합**

- 서버에서 알림 전송
- 정확한 시간 예약
- 크로스 디바이스 동기화

### **Firebase FCM**

- Google 무료 서비스
- 모바일 + 웹 통합
- 고급 알림 기능

---

## ✅ **결론**

- ✅ **웹에서도 알림 작동!**
- ✅ **브라우저 Notification API 사용**
- ✅ **PWA 설치로 더 나은 경험**
- ✅ **네이티브 앱과 동일한 UI/UX**

**이제 웹앱에서도 식사 시간 알림을 받을 수 있습니다!** 🎉📱

---

## 📞 **지원**

문제가 발생하면:
1. 브라우저 콘솔 (F12) 확인
2. 알림 권한 확인
3. 브라우저 재시작
4. 캐시 삭제 후 재접속

**Chrome 권장!** ✨
